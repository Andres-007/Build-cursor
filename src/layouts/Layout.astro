---
import '../styles/global.css';
interface Props {
  title?: string;
}
const { title = 'Asistente de Estudio' } = Astro.props;
---
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#ffffff" />
    <title>{title}</title>
  </head>
  <body>
    <header class="header">
      <a href="/" class="header-title">Asistente de Estudio</a>
      <button type="button" class="nav-toggle" id="nav-toggle" aria-label="Abrir menú" aria-expanded="false" aria-controls="main-nav">
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
      </button>
      <nav class="nav" id="main-nav" aria-label="Navegación principal">
        <a href="/">Inicio</a>
        <a href="/dashboard" data-auth="user">Dashboard</a>
        <a href="/materias/registro" data-auth="user">Registrar materia</a>
        <a href="/premium">Premium</a>
        <a href="/login" data-auth="guest">Ingresar</a>
        <a href="/registro" data-auth="guest">Registro</a>
        <span class="user-pill" id="user-pill" data-auth="user"></span>
        <button type="button" class="btn btn-outline btn-logout" id="logout-btn" data-auth="user">
          Cerrar sesión
        </button>
      </nav>
    </header>
    <main class="main">
      <slot />
    </main>
    <footer class="footer">
      <p>Cursor hackatón 2026 — Powered by WONDER</p>
    </footer>
  </body>
</html>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    var toggle = document.getElementById('nav-toggle');
    var nav = document.getElementById('main-nav');
    if (toggle && nav) {
      function openMenu() {
        nav.classList.add('nav--open');
        toggle.setAttribute('aria-expanded', 'true');
        toggle.setAttribute('aria-label', 'Cerrar menú');
      }
      function closeMenu() {
        nav.classList.remove('nav--open');
        toggle.setAttribute('aria-expanded', 'false');
        toggle.setAttribute('aria-label', 'Abrir menú');
      }
      toggle.addEventListener('click', function() {
        if (nav.classList.contains('nav--open')) closeMenu(); else openMenu();
      });
      nav.querySelectorAll('a').forEach(function(link) {
        link.addEventListener('click', closeMenu);
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeMenu();
      });
    }
  });
</script>

<script>
  const logoutBtn = document.getElementById('logout-btn');
  const userPill = document.getElementById('user-pill');
  const sessionRaw = localStorage.getItem('userSession');
  const isLoggedIn = Boolean(sessionRaw);
  const session = sessionRaw ? JSON.parse(sessionRaw) : null;

  document.querySelectorAll('[data-auth="guest"]').forEach((el) => {
    (el as HTMLElement).style.display = isLoggedIn ? 'none' : 'inline-flex';
  });
  document.querySelectorAll('[data-auth="user"]').forEach((el) => {
    (el as HTMLElement).style.display = isLoggedIn ? 'inline-flex' : 'none';
  });
  if (userPill && session?.nombre) {
    userPill.textContent = `Hola, ${session.nombre}`;
  }

  logoutBtn?.addEventListener('click', () => {
    localStorage.removeItem('userSession');
    window.location.href = '/';
  });
</script>

<style>
  .btn-logout {
    padding: 0.45rem 1rem;
    min-height: auto;
  }
  .user-pill {
    display: inline-flex;
    align-items: center;
    padding: 0.35rem 0.7rem;
    border-radius: 999px;
    background: rgba(74, 144, 217, 0.12);
    color: var(--accent);
    font-weight: 600;
    font-size: 0.85rem;
  }
</style>
